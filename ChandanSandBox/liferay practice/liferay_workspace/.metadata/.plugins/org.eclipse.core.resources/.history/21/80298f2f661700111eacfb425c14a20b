package com.server;

import com.client.BlobService;
import com.client.model.Picture;
import com.google.appengine.api.blobstore.BlobstoreService;
import com.google.appengine.api.blobstore.BlobstoreServiceFactory;
import com.google.gwt.user.server.rpc.RemoteServiceServlet;
import com.googlecode.objectify.Objectify;
import com.googlecode.objectify.ObjectifyService;

@SuppressWarnings("serial")
public class BlobServiceImpl extends RemoteServiceServlet implements
		BlobService {

	//Start a GAE BlobstoreService session and Objectify session
	  BlobstoreService blobstoreService = BlobstoreServiceFactory
	      .getBlobstoreService();
	  Objectify ofy = ObjectifyService.begin();
	  
	  //Register the Objectify Service for the Picture entity
	  static {
	    ObjectifyService.register(Picture.class);
	  }
	
	@Override
	public String getBlobStoreUploadUrl() {
		//Map the UploadURL to the uploadservice which will be called by
	    //submitting the FormPanel
	    return blobstoreService
	        .createUploadUrl("/blobstoreexample/uploadservice");
	}

	@Override
	public Picture getPicture(String id) {
		long l = Long.parseLong(id);
	    Picture picture = ofy.get(Picture.class, l);
	    return picture;
	}

}
